{% load humanize %}

<div class="chat_section_main">
    <div class="chat_section_main_area">
        {% for comment in comment_list %}
            <div class="comment_aria_list">
                <a href="{% url 'myus:userpage' comment.author.nickname %}">
                    <img src="{{ comment.author.user_image.url }}" title="{{ comment.author.nickname }}" class="profile_image_comment">
                </a>
                <div class="comment_aria_list_1">
                    <p>{{ comment.author.nickname }}</p>
                    <time>{{ comment.created|date:'Y/m/d H:i' }}</time>
                </div>
                <div class="comment_aria_list_2">{{ comment.text|urlize|linebreaks }}</div>
                <a href="{% url 'myus:chat_thread' object.pk comment.id %}" class="comment_aria_thread">
                    スレッド表示
                    <span id="reply_count_{{ comment.id }}">返信 {{ comment.reply_count|intcomma }} 件</span>
                </a>
                {% if comment.author.id == user.id %}
                <form method="POST" class="chat_button">
                    {% csrf_token %}
                    <a type="button" name="update" obj-id="{{ comment.id }}" class="chat_button_update" action="{% url 'myus:chat_message_update' comment.id %}">更新</a>

                    <a type="button" name="delete" obj-id="{{ comment.id }}" class="chat_button_delete">削除</a>
                    <div id="modal_content_{{ comment.id }}" class="modal_content">
                        <h2 class="modal_content_header">メッセージの削除</h2>

                        <span class="modal_content_body_span">このメッセージを削除しますか？</span>

                        <div class="modal_content_body">
                            <div class="comment_aria_list">
                                <a href="{% url 'myus:userpage' comment.author.nickname %}">
                                    <img src="{{ comment.author.user_image.url }}" title="{{ comment.author.nickname }}" class="profile_image_comment">
                                </a>
                                <div class="comment_aria_list_1">
                                    <p>{{ comment.author.nickname }}</p>
                                    <time>{{ comment.created|date:'Y/m/d H:i' }}</time>
                                </div>
                                <div class="comment_aria_list_2">{{ comment.text|urlize|linebreaks }}</div>
                            </div>
                        </div>

                        <div class="modal_content_footer">
                            <input type="button" name="cancel" value="キャンセル" obj-id="{{ comment.id }}" class="modal_cancel btn btn-light">
                            <input type="button" name="delete" value="削除" obj-id="{{ comment.id }}" action="{% url 'myus:chat_message_delete' comment.id %}" class="btn btn-danger">
                        </div>
                    </div>
                    <div obj-id="{{ comment.id }}" id="mask_{{ comment.id }}" class="mask modal_cancel"></div>
                </form>
                {% endif %}
            </div>
        {% endfor %}
        <div id="comment_aria_add"></div>
    </div>

    <footer class="chat_footer_main" id="footer">
        <form method="POST" action="{% url 'myus:chat_message' %}" id="comment_form" obj-id="{{ object.id }}">{% csrf_token %}
            {% if is_period %}
            <textarea name="text" rows="1" class="textarea_br" placeholder="チャット期間が過ぎています！" disabled="disabled"></textarea>
            <div class="chat_frame chat_frame_color"></div>
            <div class="comment_input_chat">
                <button type="submit" class="btn btn-secondary btn-sm" title="送信" disabled>
                    <i class="bi bi-caret-right-fill" style="font-size: 1.2em;"></i>
                </button>
            </div>
            {% elif user.is_authenticated %}
            <textarea name="text" rows="1" class="textarea_br" placeholder="メッセージ入力" required></textarea>
            <div class="chat_frame"></div>
            <div class="comment_input_chat">
                <button type="submit" class="btn btn-primary btn-sm" title="送信">
                    <i class="bi bi-caret-right-fill" style="font-size: 1.2em;"></i>
                </button>
            </div>
            {% else %}
            <textarea name="text" rows="1" class="textarea_br" placeholder="チャットするにはログインが必要です！" disabled="disabled"></textarea>
            <div class="chat_frame chat_frame_color"></div>
            <div class="comment_input_chat">
                <button type="submit" class="btn btn-secondary btn-sm" title="送信" disabled>
                    <i class="bi bi-caret-right-fill" style="font-size: 1.2em;"></i>
                </button>
            </div>
            {% endif %}
        </form>
    </footer>
</div>
