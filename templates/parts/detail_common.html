{% load static %}
{% load humanize %}

<div class="article_detail_aria">
    <h1 title="{{ object.title }}">{{ object.title }}</h1>

    <time class="article_detail_aria_1">{{ object.created|date:'Y/m/d H:i' }}</time>

    <div class="article_detail_aria_2">
        <div class="read">
            <i class="bi bi-caret-right-square icon-font" title="閲覧数"></i>
            <span>{{ object.read|intcomma }}</span>
        </div>
        {% if user.is_authenticated %}
            <form method="POST" action="{% url 'myus:like_form' %}" path="{{ request.path }}">{% csrf_token %}
                {% if liked %}
                <button type="submit" name="videomodel_id" value="{{ object.id }}" class="like_form like_fill">
                    <i class="bi bi-hand-thumbs-up-fill icon-font like_color" title="いいね"></i>
                </button>
                {% else %}
                <button type="submit" name="videomodel_id" value="{{ object.id }}" class="like_form like_no">
                    <i class="bi bi-hand-thumbs-up icon-font like_color" title="いいね"></i>
                </button>
                {% endif %}
                <span class="like_count">{{ object.total_like|intcomma }}</span>
            </form>
        {% else %}
            <i class="bi bi-hand-thumbs-up icon-font" title="いいね"></i>
            <span>{{ object.total_like|intcomma }}</span>
        {% endif %}
    </div>

    <div class="article_detail_aria_3">
        {% include 'parts/tag.html' %}
    </div>
</div>
<hr>

<input type="checkbox" id="content_detail_check_id" class="content_detail_check">
<label for="content_detail_check_id" class="content_detail_check_label1">拡大表示</label>
<label for="content_detail_check_id" class="content_detail_check_label2">縮小表示</label>

<div class="content_detail_aria">
    <div class="content_detail">
        <a href="{% url 'myus:userpage' object.author.nickname %}">
            <img src="{{ object.author.user_image.url }}" title="{{ object.author.nickname }}" class="profile_image_detail">
        </a>
        <div class="username_space">{{ object.author.nickname }}</div>
        <div class="registered_person">登録者数
            <span class="follower_count">{{ object.author.follower_count|intcomma }}</span>
        </div>
        <p class="content_detail_p1">{{ object.content|linebreaksbr|urlize }}</p>
        <p class="content_detail_p2">{{ object.lyrics|linebreaksbr }}</p>

        <div class="content_detail_p3">
            {% if user.nickname == object.author.nickname %}
            <button class="btn btn-secondary" disabled>フォローする</button>
            {% elif user.is_authenticated %}
            <form method="POST" action="{% url 'myus:follow_create' object.author.nickname %}" class="follow_form">{% csrf_token %}
                {% if followed %}
                <button type="submit" name="following_id" value="{{ object.author.nickname }}" class="btn btn-danger followchange">解除する</button>
                {% else %}
                <button type="submit" name="following_id" value="{{ object.author.nickname }}" class="btn btn-success followchange">フォローする</button>
                {% endif %}
            </form>
            {% else %}
            <button class="btn btn-secondary" disabled>フォローする</button>
            {% endif %}
        </div>
    </div>
</div>
<hr>

<form method="POST" action="{% url 'myus:comment_form' %}" id="comment_form" obj-id="{{ object.id }}" path="{{ request.path }}">{% csrf_token %}
    <div class="comment_input">
        <p>コメント総数
            <span id="comment_count">{{ object.comment_count|intcomma }}</span>
        </p>
        {% if user.is_authenticated %}
        <a href="{% url 'myus:userpage' user.nickname %}">
            <img src="{{ user.user_image.url }}" title="{{ user.nickname }}" class="profile_image_comment">
        </a>
        <textarea name="text" rows="1" class="textarea_br" placeholder="コメント入力" required></textarea>
        <input type="submit" name="text" value="コメント" class="btn btn-primary btn-sm">
        {% else %}
        <img src="{% static 'img/user_icon.png' %}" title="匿名" class="profile_image_comment">
        <textarea name="text" rows="1" class="textarea_br" placeholder="コメントするにはログインが必要です！" disabled></textarea>
        <input type="submit" name="text" value="コメント" class="btn btn-secondary btn-sm" disabled>
        {% endif %}
    </div>
</form>

<input type="checkbox" id="comment_aria_check_id" class="comment_aria_check">
<label for="comment_aria_check_id" class="comment_aria_check_label1">拡大表示</label>
<label for="comment_aria_check_id" class="comment_aria_check_label2">縮小表示</label>

<div class="comment_aria">
    <div id="comment_aria_add"></div>

    {% for comment in comment_list reversed %}
        <div id="comment_aria_list_{{ comment.id }}" class="comment_aria_list">
            <a href="{% url 'myus:userpage' comment.author.nickname %}">
                <img src="{{ comment.author.user_image.url }}" title="{{ comment.author.nickname }}" class="profile_image_comment">
            </a>

            <div class="comment_aria_list_1">
                <p>{{ comment.author.nickname }}</p>
                <time>{{ comment.created|date:'Y/m/d H:i' }}</time>
            </div>

            <div class="comment_aria_list_2">{{ comment.text|linebreaksbr|urlize }}</div>

            <div class="comment_aria_list_3">
                {% if user.is_authenticated %}
                <form method="POST" action="{% url 'myus:like_form_comment' %}" class="like_form_aria">
                    {% csrf_token %}
                    {% if comment.comment_liked %}
                    <button type="submit" name="comment_id" value="{{ comment.id }}" class="like_form_comment like_fill">
                        <i class="bi bi-hand-thumbs-up-fill icon-font like_color_{{ comment.id }}" title="いいね"></i>
                    </button>
                    {% else %}
                    <button type="submit" name="comment_id" value="{{ comment.id }}" class="like_form_comment like_no">
                        <i class="bi bi-hand-thumbs-up icon-font like_color_{{ comment.id }}" title="いいね"></i>
                    </button>
                    {% endif %}
                </form>
                {% else %}
                <i class="bi bi-hand-thumbs-up icon-font rgb100" title="いいね"></i>
                {% endif %}
                <span id="like_count_{{ comment.id }}" class="like_count rgb100">{{ comment.total_like|intcomma }}</span>

                <label id="reply_button_{{ comment.id }}" comment-id="{{ comment.id }}" class="reply_button">▼ 返信</label>
                <label id="reply_button_cancel_{{ comment.id }}" comment-id="{{ comment.id }}" class="reply_button_cancel vanish">▲ 返信</label>

                <label id="reply_list_button_{{ comment.id }}" comment-id="{{ comment.id }}" class="reply_list_button">
                    <span id="reply_count_{{ comment.id }}" class="reply_count">▼ スレッド {{ comment.reply_count|intcomma }} 件</span>
                    <span>表示</span>
                </label>
                <label id="reply_list_button_cancel_{{ comment.id }}" comment-id="{{ comment.id }}" class="reply_list_button_cancel vanish">
                    <span id="reply_count_{{ comment.id }}" class="reply_count">▲ スレッド {{ comment.reply_count|intcomma }} 件</span>
                    <span>表示</span>
                </label>

                <form method="POST" action="{% url 'myus:reply_form' %}" obj-id="{{ object.id }}" comment-id="{{ comment.id }}" path="{{ request.path }}" id="comment_aria_list_reply_{{ comment.id }}" class="comment_aria_list_4 reply_form">
                    {% csrf_token %}
                    <div class="reply_input">
                        {% if user.is_authenticated %}
                        <a href="{% url 'myus:userpage' user.nickname %}">
                            <img src="{{ user.user_image.url }}" title="{{ user.nickname }}" class="profile_image_reply">
                        </a>
                        <textarea name="reply" rows="1" class="textarea_br" placeholder="返信コメント入力" required></textarea>
                        <div class="reply_button_group">
                            <input type="button" name="cancel" value="キャンセル" comment-id="{{ comment.id }}" class="btn btn-light btn-xs reply_cancel_button">
                            <input type="submit" name="reply_form" value="コメント" class="btn btn-primary btn-xs">
                        </div>
                        {% else %}
                        <img src="{% static 'img/user_icon.png' %}" title="匿名" class="profile_image_reply">
                        <textarea name="reply" rows="1" class="textarea_br" placeholder="返信コメントするにはログインが必要です！" disabled></textarea>
                        <div class="reply_button_group">
                            <input type="button" name="cancel" value="キャンセル" comment-id="{{ comment.id }}" class="btn btn-light btn-xs reply_cancel_button">
                            <input type="submit" name="reply_form" value="コメント" class="btn btn-secondary btn-xs" disabled>
                        </div>
                        {% endif %}
                    </div>
                </form>

                <div class="comment_aria_list_space"></div>

                <div id="reply_aria_list_{{ comment.id }}" class="comment_aria_list_5">
                <div id="reply_aria_add"></div>
                {% for reply in reply_list reversed %}
                    {% if reply.parent.id == comment.id %}
                    <div id="comment_aria_list_{{ reply.id }}" class="reply_aria_list">
                        <a href="{% url 'myus:userpage' reply.author.nickname %}">
                            <img src="{{ reply.author.user_image.url }}" title="{{ reply.author.nickname }}" class="profile_image_reply">
                        </a>

                        <div class="reply_aria_list_1">
                            <p>{{ reply.author.nickname }}</p>
                            <time>{{ reply.created|date:'Y/m/d H:i' }}</time>
                        </div>

                        <div class="reply_aria_list_2">{{ reply.text|linebreaksbr|urlize }}</div>

                        <div class="reply_aria_list_3">{{ reply.comment_liked }}
                            {% if user.is_authenticated %}
                            <form method="POST" action="{% url 'myus:like_form_comment' %}" class="like_form_aria">{% csrf_token %}
                                {% if reply.comment_liked %}
                                <button type="submit" name="comment_id" value="{{ reply.id }}" class="like_form_comment like_fill">
                                    <i class="bi bi-hand-thumbs-up-fill icon-font like_color_{{ reply.id }}" title="いいね"></i>
                                </button>
                                {% else %}
                                <button type="submit" name="comment_id" value="{{ reply.id }}" class="like_form_comment like_no">
                                    <i class="bi bi-hand-thumbs-up icon-font like_color_{{ reply.id }}" title="いいね"></i>
                                </button>
                                {% endif %}
                            </form>
                            {% else %}
                            <i class="bi bi-hand-thumbs-up icon-font rgb100" title="いいね"></i>
                            {% endif %}
                            <span id="like_count_{{ reply.id }}" class="like_count rgb100">{{ reply.total_like|intcomma }}</span>
                        </div>
                        {% if reply.author.id == user.id %}
                            <div class="edit_button_reply">
                            {% include 'parts/modal_content_reply.html' %}
                            </div>
                        {% endif %}
                    </div>
                    <div id="edit_update_main_{{ reply.id }}" class="edit_update_main">
                        <form method="POST" action="{% url 'myus:chat_message_update' reply.id %}" comment-id="{{ object.id }}" class="edit_update_form">
                            {% csrf_token %}
                            <a href="{% url 'myus:userpage' reply.author.nickname %}">
                                <img src="{{ reply.author.user_image.url }}" title="{{ reply.author.nickname }}" class="profile_image_reply">
                            </a>
                            <div class="comment_input_update">
                                <textarea name="update_text" rows="1" class="textarea_br" placeholder="コメント入力" id="comment_form_update_{{ reply.id }}" required>{{ reply.text }}</textarea>
                                <div class="edit_update_footer">
                                    <input type="button" name="cancel" value="キャンセル" comment-id="{{ reply.id }}" class="btn btn-light btn-xs edit_update_cancel">
                                    <input type="submit" name="update" value="更新" class="btn btn-success btn-xs">
                                </div>
                            </div>
                        </form>
                    </div>
                    {% endif %}
                {% endfor %}
                </div>
            </div>
            {% if comment.author.id == user.id %}
                {% include 'parts/modal_content_comment.html' %}
            {% endif %}
        </div>
        <div id="edit_update_main_{{ comment.id }}" class="edit_update_main">
            <form method="POST" action="{% url 'myus:chat_message_update' comment.id %}" comment-id="{{ comment.id }}" class="edit_update">
                {% csrf_token %}
                <a href="{% url 'myus:userpage' comment.author.nickname %}">
                    <img src="{{ comment.author.user_image.url }}" title="{{ comment.author.nickname }}" class="profile_image_comment">
                </a>
                <div class="comment_input_update">
                    <textarea name="update_text" rows="1" class="textarea_br" placeholder="コメント入力" id="comment_form_update_{{ comment.id }}" required>{{ comment.text }}</textarea>
                    <div class="edit_update_footer">
                        <input type="button" name="cancel" value="キャンセル" comment-id="{{ comment.id }}" class="btn btn-light btn-xs edit_update_cancel">
                        <input type="submit" name="update" value="更新" class="btn btn-success btn-xs">
                    </div>
                </div>
            </form>
        </div>
    {% endfor %}
</div>

<hr class="comment_aria_hr">

<div class="advertise_aria">
    <h2>広告表示</h2>
    {% include 'parts/article_advertise.html' %}
</div>
