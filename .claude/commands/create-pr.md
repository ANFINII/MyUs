# PR作成

現在のブランチから `main` ブランチへのPull Requestを作成します。

## 実行手順

### 1. 事前チェック
以下を並列で実行して状態を確認：
- `git status` - 未コミットの変更がないか確認
- `git log main..HEAD --oneline` - mainからのコミット一覧
- `git diff main...HEAD --stat` - 変更ファイルの統計
- `git branch --show-current` - 現在のブランチ名

**中止条件：**
- mainからのコミットが0件かつステージングされた変更もない場合 → 「コミットがありません」と伝えて終了

**ステージングされた変更がある場合：**
- ステージングされた変更のみをコミット&プッシュしてからPR作成に進む

### 1.5. mainブランチの場合：新規ブランチを作成
現在のブランチが `main` の場合、PR作成前に新規ブランチを切る。

**ブランチ名の決定ルール：**

1. **プレフィックス**: 変更ファイルのパスに基づいて決定
   | 条件 | プレフィックス |
   |------|---------------|
   | `myus/` 配下の変更がある | `back` |
   | `frontend/` 配下の変更がある | `front` |
   | 上記以外 | `other` |
   - 優先順位: back > front > other

2. **サフィックス**: 変更の種類に基づいて決定
   | 種類 | サフィックス |
   |------|-------------|
   | 既存機能の修正・リファクタリング | `_fix` |
   | 新機能追加 | `_feat` |

3. **ブランチ名本体**: 変更内容を簡潔に表すsnake_caseの名前
   - 既存ブランチと被らないようにする
   - 過去のブランチ名のスタイルを参考にする（`git branch -a` で確認）

**過去のブランチ名の例：**
- `back_fix_user_domain_convert_refactor`
- `back_feat_auth_check`
- `front_fix_mypage_edit_banner`
- `front_feat_BackLogin`

**手順：**
1. `git branch -a` で既存ブランチ名を確認し、被りがないか確認
2. `{プレフィックス}_{サフィックス}_{名前}` の形式でブランチ名を決定
3. `git checkout -b {ブランチ名}` で新規ブランチを作成
4. 以降の手順を継続

### 2. 変更内容の分析
`git diff main...HEAD` で詳細な差分を取得し、以下を把握：
- どのファイルが変更されたか
- 何が追加・削除・修正されたか
- 変更の目的・意図

### 3. PRタイトルのプレフィックス判定
変更ファイルのパスに基づいてプレフィックスを決定：

| 条件 | プレフィックス |
|------|---------------|
| `myus/` 配下の変更がある | 【back】 |
| `frontend/` 配下の変更がある | 【front】 |
| `documents/` や `.md` ファイルのみ | 【docs】 |
| 上記以外・混在 | 【other】 |

**優先順位**: back > front > docs > other
（複数領域にまたがる場合はコードの変更を優先）

### 4. PR作成
`gh pr create` で以下の形式のPRを作成：

```bash
gh pr create --title "【プレフィックス】タイトル" --body "$(cat <<'EOF'
## Summary
- 変更の概要を簡潔に箇条書き（1-3項目）

## 変更内容
具体的な変更点を記載。必要に応じてセクション分け：
- ファイル名や機能ごとにグループ化
- コードの変更意図を説明
EOF
)" --base main
```

### 5. コードレビュー
PR作成後、`gh api` を使ってGitHub上にレビューコメントを投稿する。

**レビュー観点：**
- バグ・ランタイムエラーの可能性
- デッドコード・未使用のインポート
- パフォーマンス問題（N+1クエリ、不要なDBフェッチなど）
- 命名の不統一・不適切な変数名
- ハードコードされた値
- 層の分離違反（ドメイン層にリクエスト層の型が混在など）
- セキュリティ上の懸念

**レビュー形式：**
- `gh api repos/{owner}/{repo}/pulls/{pr_number}/reviews` で総評レビューを投稿
- `event` は `"COMMENT"` を使用（自分のPRには `REQUEST_CHANGES` が使えないため）
- 総評を `body` に記載

### 6. 結果報告
- 成功時：PRのURLとレビューのURLを表示
- 失敗時：エラー内容と対処法を案内
