# MyUs - 総合メディアプラットフォーム SNS 設計書

## サービス概要

MyUsは「My Idea Know Us」を由来とする、YouTube型UIを採用した総合メディアプラットフォームSNSです。動画、音楽、漫画、画像、ブログ、チャットなど多様なメディアコンテンツの投稿・共有が可能で、リアルタイム通信機能も備えた統合型プラットフォームです。

## 主要機能

### コンテンツ投稿機能
- **Video**: 動画アップロード（変換機能付き）
- **Music**: 音楽アップロード（歌詞・ダウンロード機能付き）
- **Comic**: 漫画投稿（複数ページ対応）
- **Picture**: 画像投稿
- **Blog**: リッチテキストエディタ対応ブログ
- **Chat**: リアルタイムチャット（WebSocket使用）

### ユーザー機能
- 認証システム（メール認証、ログイン/ログアウト）
- プロフィール管理（個人情報、アバター、バナー）
- マイページ機能（フォロー/フォロワー管理）
- 通知設定（メディアタイプ別、アクション別）
- 料金プラン管理（Stripe決済連携）

### インタラクション機能
- いいね機能（全メディアタイプ対応）
- コメント・リプライ（階層構造対応）
- フォロー/フォロワー機能
- 検索機能（タグ、ハッシュタグ、全文検索）
- 通知システム（リアルタイム通知）

## システム設計図

### データモデル構造

```
【User System】
User (認証・基本情報)
  ├─ Profile (個人情報: 氏名、生年月日、住所等)
  ├─ MyPage (公開情報: バナー、自己紹介、フォロワー数)
  ├─ UserNotification (通知設定)
  ├─ UserPlan (料金プラン: Stripe連携)
  └─ Channel (複数チャンネル管理)
        └─ is_default: デフォルトチャンネルフラグ

【Channel System】
Channel (チャンネル管理)
  ├─ owner (User): チャンネル所有者
  ├─ avatar: チャンネルアバター画像
  ├─ name: チャンネル名
  ├─ description: チャンネル説明
  ├─ is_default: デフォルトチャンネルフラグ
  └─ メディアコンテンツ (1対多)
        ├─ videos
        ├─ musics
        ├─ comics
        ├─ pictures
        ├─ blogs
        └─ chats

【Media Contents】
※ 全メディアはChannelに紐づく（User直接ではなくChannel経由）

Video (動画投稿)
  ├─ channel (Channel): 所属チャンネル
  ├─ 動画ファイル、変換ファイル、サムネイル
  └─ カテゴリー、ハッシュタグ、いいね、閲覧数

Music (音楽投稿)
  ├─ 音楽ファイル、歌詞
  └─ ダウンロード可否設定

Comic (漫画投稿)
  ├─ ComicPage (複数ページ管理)
  └─ ページ順序管理

Picture (画像投稿)
Blog (ブログ投稿: Quillエディタ対応)
Chat (チャット: WebSocket対応、期限設定)

【Interaction System】
Comment (コメント機能)
  ├─ 階層構造（parent-child）
  └─ いいね機能付き

Message (チャット内メッセージ)
  ├─ スレッド対応
  └─ Quillエディタ対応

Follow (フォロー関係管理)
Notification (通知システム)
  └─ 確認済み/削除済み管理

【Master & Others】
Plan (料金プラン管理)
Category (カテゴリーマスタ)
HashTag (ハッシュタグマスタ)
SearchTag (ユーザー検索タグ)
AccessLog (アクセスログ)
Advertise (広告管理)
```

## データモデル詳細

### ユーザーシステム

#### User
- 認証情報（メール、ユーザー名、ニックネーム）
- アバター画像
- アクティブ状態、スタッフ権限
- 関連モデルへの自動生成トリガー

#### Profile
- 個人情報（氏名、生年月日、性別）
- 連絡先（電話番号）
- 住所情報（国、郵便番号、都道府県、市区町村、番地）
- 自己紹介文

#### MyPage
- 公開プロフィール情報
- バナー画像
- フォロワー/フォロー数カウント
- 広告表示設定
- Google Tag Manager ID

#### UserNotification
- メディアタイプ別通知設定（動画、音楽、漫画、画像、ブログ、チャット）
- アクション別通知設定（フォロー、リプライ、いいね、閲覧）

#### UserPlan
- 料金プラン情報
- Stripe顧客ID、サブスクリプションID
- 支払い状態
- プラン開始/終了日

### チャンネルシステム

#### Channel
YouTubeのチャンネルと同様の概念。1人のユーザーが複数のチャンネルを所有でき、各チャンネルにメディアコンテンツを投稿する。

- **owner**: チャンネル所有者（User）
- **ulid**: ユニーク識別子（ULID形式）
- **avatar**: チャンネルアバター画像
- **name**: チャンネル名（最大100文字）
- **description**: チャンネル説明
- **is_default**: デフォルトチャンネルフラグ
  - ユーザー作成時に1つのデフォルトチャンネルが自動生成される
  - メディア投稿時、明示的な指定がない場合はデフォルトチャンネルに投稿
- **created/updated**: 作成/更新日時

#### チャンネルの利用フロー
1. ユーザー登録時にデフォルトチャンネルが自動作成される
2. メディア投稿時、ユーザーのデフォルトチャンネル（`is_default=True`）を取得
3. メディアはチャンネルに紐づいて作成される
4. メディア一覧・詳細では `channel.owner` から作者情報を取得

### メディアコンテンツ

#### 共通機能（MediaModel）
- **channel**: 所属チャンネル（Channel経由で作者を取得: `channel.owner`）
- **ulid**: ユニーク識別子（ULID形式）
- タイトル、説明文（content）
- カテゴリー、ハッシュタグ（多対多）
- いいね機能（多対多: User）
- 閲覧数カウント（read）
- 公開/非公開設定（publish）
- 作成/更新日時（created/updated）

#### Video（動画）
- 動画ファイル、変換済みファイル
- サムネイル画像
- 検索対応（タイトル、ハッシュタグ、作者、内容）

#### Music（音楽）
- 音楽ファイル
- 歌詞テキスト
- ダウンロード許可設定
- 検索対応（歌詞も含む）

#### Comic（漫画）
- メイン画像
- ComicPageによる複数ページ管理
- ページ順序制御

#### Picture（画像）
- 画像ファイル
- シンプルな画像投稿機能

#### Blog（ブログ）
- リッチテキスト（Quillエディタ）
- プレーンテキスト
- デルタ形式データ
- サムネイル画像

#### Chat（チャット）
- 有効期限設定
- リアルタイム通信対応
- スレッド数、参加者数カウント
- スコア計算機能

### インタラクションシステム

#### Comment
- 階層構造（自己参照による親子関係）
- メディアタイプとIDによる汎用的な関連付け
- いいね機能
- リプライ数カウント

#### Message
- Chat内でのメッセージ
- スレッド対応（親子関係）
- Quillエディタ対応

#### Follow
- フォロワー/フォロー関係管理
- 双方向の関係を記録

#### Notification
- 送信者/受信者
- 通知タイプとオブジェクトの汎用的な関連付け
- 確認済み/削除済み状態管理

### マスターデータ・その他

#### Plan
- 料金プラン定義
- Stripe API ID
- 価格、広告表示上限

#### Category / HashTag
- 日本語/英語名称管理
- メディアコンテンツとの多対多関連

#### SearchTag
- ユーザー毎の検索タグ管理
- 表示順序制御

#### AccessLog
- IPアドレス記録
- アクセス対象の記録

#### Advertise
- 広告コンテンツ管理
- 画像/動画対応
- 表示期間設定
- 全体/個別配信設定

## 技術アーキテクチャ

### バックエンド
- **フレームワーク**: Django (Python)
- **データベース**: PostgreSQL/MySQL（推定）
- **認証**: Django標準認証システム（カスタマイズ）
- **API**: Django REST Framework（推定）

### フロントエンド
- **言語**: TypeScript/JavaScript
- **UI**: YouTube風インターフェース
- **非同期通信**: Ajax/Pjax

### リアルタイム通信
- **WebSocket**: チャット機能
- **スレッド対応**: 並行処理

### 外部連携
- **決済**: Stripe API
- **メール**: Django標準メール機能
- **ファイルアップロード**: カスタムアップロード関数

### パフォーマンス最適化
- **インデックス**: 主要検索フィールドに設定
- **Select/Prefetch Related**: N+1問題対策
- **カスタムQuerySet**: 効率的な検索実装

## セキュリティ設計

### 認証・認可
- メール認証必須
- パスワードハッシュ化
- セッション管理

### データ保護
- CSRF対策（Django標準）
- XSS対策（テンプレートエスケープ）
- SQLインジェクション対策（ORM使用）

### プライバシー
- 個人情報の適切な分離（Profile/MyPage）
- 通知設定による情報公開制御
- フォロー関係による閲覧制限（推定）

## 拡張性

### プラグイン構造
- メディアタイプの追加が容易
- 共通基底クラス（MediaModel）の活用

### 国際化対応
- カテゴリー/ハッシュタグの多言語対応
- 日本語/英語の併記

### スケーラビリティ
- 非同期処理（Ajax/WebSocket）
- インデックス最適化
- キャッシュ機構（実装予定）

## 今後の展開

### 開発中機能
- 決済システムの完全統合
- 急上昇コンテンツ機能
- Knowledge Base

### 改善ポイント
- モバイルアプリ対応
- AI/機械学習による推薦システム
- コンテンツモデレーション機能
- 分析ダッシュボード

---

## 更新履歴

- **2026-01-21**: チャンネルシステムを追加（YouTubeのようなチャンネル概念を導入）
  - Channelモデルの追加
  - 全メディアがUserではなくChannel経由で管理されるよう変更
  - チャンネルの利用フローを文書化
